<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<title>Plot Results</title>
<script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=AIzaSyALOwoKz_Rw_ocZ9Cd8jyfUi3iNGTFzmT0" type="text/javascript"></script>
<script src="/site_media/jquery.js" type="text/javascript"></script>

<script type="text/javascript">
    /* This isochrone generate is derived from http://sandropaganotti.com/generate-an-isochrone-map-using-google-maps-api/ */    
    var DEFAULT_LAT = 33.781002;
    var DEFAULT_LNG = -84.38942; 

    var points =  new Array();

    var greenIcon = new GIcon(G_DEFAULT_ICON);
    var redIcon = new GIcon(G_DEFAULT_ICON);
    var busIcon = new GIcon(G_DEFAULT_ICON);

    function initialize() {
      if (GBrowserIsCompatible()) {
        map = new GMap2(document.getElementById("map_canvas"));
        map.setCenter(new GLatLng(DEFAULT_LAT, DEFAULT_LNG), 13);
        geocoder = new GClientGeocoder();
        directionsPanel = document.getElementById("map_text");
        directions = new GDirections(map, directionsPanel);
      }
    }


    function get_passengers(vehicle_id){
        $.get('/get_passenger_results/', {"vehicle_id":vehicle_id},
        function(data){
	       map.clearOverlays();
               var points =  new Array();

           
               var message = $.parseJSON(data);
	       var starts = message['starts'];
               var ends = message['ends'];
               var times = message['times'];
               var stops = message['stops'];
               var second = message['second'];
               var flexbus_location = message['flexbus_location']
    
               for (var i = 0; i < stops.length; i++) {
		   points.push(new GLatLng(stops[i][0], stops[i][1]));
	       }
               map.addOverlay(new GPolyline(points));

               var html_data = "<b>Passenger Times at second, " + second + ":</b>"; 
	       
	       for (var i = 0; i < starts.length; i++) {

	           greenIcon.image = "https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=" + i + "|00AA00|000000";
		   var greenMarkerOptions = { icon:greenIcon };

                   redIcon.image = "https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=" + i + "|FF0000|000000";
		   var redMarkerOptions = { icon:redIcon };
	
		   map.addOverlay(new GMarker(new GLatLng(starts[i][0], starts[i][1]),greenMarkerOptions));				   
		   map.addOverlay(new GMarker(new GLatLng(ends[i][0], ends[i][1]), redMarkerOptions));				   

	           html_data = html_data + "<br>P" + i + ":  " + times[i][0] + ", " + times[i][1] + ", "  + times[i][2] + ", " + times[i][3];

	       } 
	       
               busIcon.image = "https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld=" + 'BUS' + "|0000FF|000000";
	       var busMarkerOptions = { icon:busIcon };
               map.addOverlay(new GMarker(new GLatLng(flexbus_location[0], flexbus_location[1]) ,busMarkerOptions));				   

				   
	      $('#passenger_times').html(html_data);
				   
				   
        }
        );
    }

</script>
<style>
table,td,th
{
border:0px solid black;
}
table
{
width:100%;
}
th
{
height:100%;
}
</style>
</head>
<body style="margin:0px; padding:0px; background: #DDDDDD;" onload="initialize()"  onunload="GUnload()">
  <center>
      <div style="padding-top: 4px; padding-bottom: 4px;">
          <label for="flexbus"/>     See Results for FlexBus:    </label>
          <input type="text" id="flexbus" name="flexbus" size="3" maxlength="4" value="1"/>
	  <input type="submit" value="Show Passengers"
                 onclick="this.value='Woot!';get_passengers(document.getElementById('flexbus').value)"/>
          <img id="loader" src="/site_media/loader.gif" style="display:none;"/>
     </div>
     <table><tr><td style="width:300px; vertical-align:top;">
     <div id="passenger_times" syle="width:300px;">
     <b>Passenger Times:<b>
       </div>
	 </td>
     <td style="width:1000px;">
       <div id="map_canvas" style="width:1000px; height:800px; border: 3px solid rgb(51, 51, 51);"></div>
     </td></tr>
     </table>

     <div style="padding-top: 10px;">
       Show some results and stuff.
     </div>
  </center>
  <textarea id="txt1" style="display:none;"></textarea>
  <div id="map_text" style="width:30%; height:800px; float: left;"></div>
</body>
</html>
